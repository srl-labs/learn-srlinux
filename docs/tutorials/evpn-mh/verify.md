---
comments: true
tags:
  - evpn
  - route-types
  - multihoming
  - ethernet-segments
---

Here, we review the configurations made in the previous section.

On the PE side, the `lag1` was created in both `leaf1` and `leaf2`. Let's take a look at them with these show commands:

```
A:leaf1# show interface lag1
==========================================================================================================================================
lag1 is up, speed None, type None
  lag1.0 is up
    Network-instance: mac-vrf-1
    Encapsulation   : null
    Type            : bridged
------------------------------------------------------------------------------------------------------------------------------------------
==========================================================================================================================================
--{ running }--[  ]--
A:leaf1# show lag lag1 lacp-state
------------------------------------------------------------------------------------------------------------------------------------------
LACP State for lag1
------------------------------------------------------------------------------------------------------------------------------------------
Lag Id         : lag1
Interval       : SLOW
Mode           : ACTIVE
System Id      : 00:00:00:00:00:11
System Priority: 11
+--------------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+
|   Members    |   Oper    | Activity  |  Timeout  |   State   | System Id | Oper key  |  Partner  |  Partner  |  Port No  |  Partner  |
|              |   state   |           |           |           |           |           |    Id     |    Key    |           |  Port No  |
+==============+===========+===========+===========+===========+===========+===========+===========+===========+===========+===========+
| ethernet-1/1 | up        | ACTIVE    | LONG      | IN_SYNC/T | 00:00:00: | 11        | 00:C1:AB: | 15        | 1         | 1         |
|              |           |           |           | rue/True/ | 00:00:11  |           | 00:00:11  |           |           |           |
|              |           |           |           | True      |           |           |           |           |           |           |
+--------------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+
------------------------------------------------------------------------------------------------------------------------------------------
```

The LAG status and network instance can be seen in the `show interface lag1` output, and `show lag lag1 lacp-state` command shows the LACP parameters as well as the status information of the member ports.

The output in leaf1 and leaf2 is expected to be the same, except for `partner port no`, which is unique per peer.

To see the details of ES-1:

```
A:leaf1# show system network-instance ethernet-segments ES-1 detail
===============================================================================================================
Ethernet Segment
===============================================================================================================
Name                 : ES-1
Admin State          : enable              Oper State        : up
ESI                  : 01:11:11:11:11:11:11:00:00:01
Multi-homing         : all-active          Oper Multi-homing : all-active
Interface            : lag1
Next Hop             : N/A
EVI                  : N/A
ES Activation Timer  : None
DF Election          : default             Oper DF Election  : default

Last Change          : 2023-08-16T14:53:30.270Z
===============================================================================================================
MAC-VRF   Actv Timer Rem   DF
ES-1      0                Yes
---------------------------------------------------------------------------------------------------------------
DF Candidates
---------------------------------------------------------------------------------------------------------------
Network-instance       ES Peers
mac-vrf-1              10.0.0.1
mac-vrf-1              10.0.0.2 (DF)
===============================================================================================================
```

> Check the same in leaf2.

The configured ES parameters are displayed here, as well as the ES peers and the selected DF.

Let's send some CE to CE traffic at this point to see if multihoming works. Also for SR Linux fabric to learn some MACs.

Connect to `ce1` and send packets to the remote IP addresses:

=== "nmap"
    ```
    bash-5.0# nmap -PE 192.168.0.21-23
    Starting Nmap 7.80 ( https://nmap.org ) at 2023-08-17 13:52 UTC
    Nmap scan report for 192.168.0.21
    Host is up (0.0027s latency).
    All 1000 scanned ports on 192.168.0.21 are closed
    MAC Address: 00:C1:AB:00:00:21 (Unknown)

    Nmap scan report for 192.168.0.22
    Host is up (0.0028s latency).
    All 1000 scanned ports on 192.168.0.22 are closed
    MAC Address: 00:C1:AB:00:00:22 (Unknown)
    
    Nmap scan report for 192.168.0.23
    Host is up (0.0024s latency).
    All 1000 scanned ports on 192.168.0.23 are closed
    MAC Address: 00:C1:AB:00:00:23 (Unknown)
    
    Nmap done: 3 IP addresses (3 hosts up) scanned in 12.80 seconds
    ```
=== "eth1 tcpdump"
    ```
    bash-5.0# tcpdump -ni eth1
    tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
    listening on eth1, link-type EN10MB (Ethernet), capture size 262144 bytes
    13:58:07.487592 LACPv1, length 110
    13:58:10.807635 ARP, Request who-has 192.168.0.22 tell 192.168.0.11, length 28
    13:58:10.807677 ARP, Request who-has 192.168.0.23 tell 192.168.0.11, length 28
    13:58:10.807687 ARP, Request who-has 192.168.0.21 tell 192.168.0.11, length 28
    13:58:10.810885 ARP, Reply 192.168.0.22 is-at 00:c1:ab:00:00:22, length 28
    13:58:10.810990 ARP, Reply 192.168.0.23 is-at 00:c1:ab:00:00:23, length 28
    13:58:10.857873 IP 192.168.0.11.49747 > 192.168.0.23.445: Flags [S], seq 2625981132, win 1024, options [mss 1460], length 0
    13:58:10.857902 IP 192.168.0.11.49747 > 192.168.0.21.445: Flags [S], seq 2625981132, win 1024, options [mss 1460], length 0
    13:58:10.857936 IP 192.168.0.11.49747 > 192.168.0.23.23: Flags [S], seq 2625981132, win 1024, options [mss 1460], length 0
    13:58:10.857949 IP 192.168.0.11.49747 > 192.168.0.21.23: Flags [S], seq 2625981132, win 1024, options [mss 1460], length 0
    13:58:10.857975 IP 192.168.0.11.49747 > 192.168.0.23.3389: Flags [S], seq 2625981132, win 1024, options [mss 1460], length 0
    13:58:10.857989 IP 192.168.0.11.49747 > 192.168.0.21.3389: Flags [S], seq 2625981132, win 1024, options [mss 1460], length 0
    13:58:10.860176 IP 192.168.0.22.23 > 192.168.0.11.49747: Flags [R.], seq 0, ack 2625981133, win 0, length 0
    13:58:10.860265 IP 192.168.0.22.443 > 192.168.0.11.49747: Flags [R.], seq 0, ack 2625981133, win 0, length 0
    13:58:10.862538 IP 192.168.0.11.49747 > 192.168.0.23.443: Flags [S], seq 2625981132, win 1024, options [mss 1460], length 0
    13:58:10.862585 IP 192.168.0.11.49747 > 192.168.0.21.443: Flags [S], seq 2625981132, win 1024, options [mss 1460], length 0
    13:58:10.862647 IP 192.168.0.11.49747 > 192.168.0.23.199: Flags [S], seq 2625981132, win 1024, options [mss 1460], length 0
    13:58:10.862696 IP 192.168.0.11.49747 > 192.168.0.21.199: Flags [S], seq 2625981132, win 1024, options [mss 1460], length 0
    13:58:10.862795 IP 192.168.0.11.49747 > 192.168.0.23.111: Flags [S], seq 2625981132, win 1024, options [mss 1460], length 0
    ```
=== "eth2 tcpdump"
    ```
    bash-5.0# tcpdump -ni eth2
    tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
    listening on eth2, link-type EN10MB (Ethernet), capture size 262144 bytes
    13:58:10.810595 ARP, Reply 192.168.0.21 is-at 00:c1:ab:00:00:21, length 28
    13:58:10.857768 IP 192.168.0.11.49747 > 192.168.0.22.445: Flags [S], seq 2625981132, win 1024, options [mss 1460], length 0
    13:58:10.857916 IP 192.168.0.11.49747 > 192.168.0.22.23: Flags [S], seq 2625981132, win 1024, options [mss 1460], length 0
    13:58:10.857962 IP 192.168.0.11.49747 > 192.168.0.22.3389: Flags [S], seq 2625981132, win 1024, options [mss 1460], length 0
    13:58:10.858002 IP 192.168.0.11.49747 > 192.168.0.22.443: Flags [S], seq 2625981132, win 1024, options [mss 1460], length 0
    13:58:10.859723 IP 192.168.0.22.445 > 192.168.0.11.49747: Flags [R.], seq 0, ack 2625981133, win 0, length 0
    13:58:10.859846 IP 192.168.0.22.3389 > 192.168.0.11.49747: Flags [R.], seq 0, ack 2625981133, win 0, length 0
    13:58:10.862474 IP 192.168.0.11.49747 > 192.168.0.22.199: Flags [S], seq 2625981132, win 1024, options [mss 1460], length 0
    13:58:10.862478 IP 192.168.0.23.445 > 192.168.0.11.49747: Flags [R.], seq 0, ack 2625981133, win 0, length 0
    13:58:10.862592 IP 192.168.0.21.445 > 192.168.0.11.49747: Flags [R.], seq 0, ack 2625981133, win 0, length 0
    13:58:10.862620 IP 192.168.0.11.49747 > 192.168.0.22.111: Flags [S], seq 2625981132, win 1024, options [mss 1460], length 0
    13:58:10.862653 IP 192.168.0.23.3389 > 192.168.0.11.49747: Flags [R.], seq 0, ack 2625981133, win 0, length 0
    13:58:10.862727 IP 192.168.0.11.49747 > 192.168.0.22.143: Flags [S], seq 2625981132, win 1024, options [mss 1460], length 0
    13:58:10.862772 IP 192.168.0.21.3389 > 192.168.0.11.49747: Flags [R.], seq 0, ack 2625981133, win 0, length 0
    13:58:10.866605 IP 192.168.0.11.49747 > 192.168.0.22.80: Flags [S], seq 2625981132, win 1024, options [mss 1460], length 0
    ```

Check the tcpdump of `eth1` and `eth2` when sending traffic with nmap and see that traffic is balanced for both incoming and outgoing packets.
> Outgoing ARP packets may not be balanced because load balancing mode of the bond is layer2 by default.

Now we must have triggered some EVPN routes in the fabric.

Remembering the route-types mentioned earlier, let's check what leaf1 and leaf2 (ES peers) advertises:

=== "leaf1"
    ```
    A:leaf1# show network-instance default protocols bgp neighbor 10.0.0.2 advertised-routes evpn
    ---------------------------------------------------------------------------------------------------------------------------------------------------    -----------
    Peer        : 10.0.0.2, remote AS: 100, local AS: 100
    Type        : static
    Description : None
    Group       : iBGP-overlay
    ---------------------------------------------------------------------------------------------------------------------------------------------------    -----------
    Origin codes: i=IGP, e=EGP, ?=incomplete
    ---------------------------------------------------------------------------------------------------------------------------------------------------    -----------
    ---------------------------------------------------------------------------------------------------------------------------------------------------    -----------
    Type 1 Ethernet Auto-Discovery Routes
    +------------------------+--------------------------------+------------+------------------------+------------------------+---------    +------------------------+
    |  Route-distinguisher   |              ESI               |   Tag-ID   |        Next-Hop        |          MED           | LocPref |              Path          |
    +========================+================================+============+========================+========================+=========    +========================+
    | 10.0.0.1:111           | 01:11:11:11:11:11:11:00:00:01  | 0          | 10.0.0.1               | -                      |     100     |                        |
    | 10.0.0.1:111           | 01:11:11:11:11:11:11:00:00:01  | 4294967295 | 10.0.0.1               | -                      |     100     |                        |
    +------------------------+--------------------------------+------------+------------------------+------------------------+---------    +------------------------+
    Type 2 MAC-IP Advertisement Routes
    +---------------------+------------+-------------------+---------------------+---------------------+---------------------+---------    +---------------------+
    | Route-distinguisher |   Tag-ID   |    MAC-address    |     IP-address      |      Next-Hop       |         MED         | LocPref |            Path         |
    +=====================+============+===================+=====================+=====================+=====================+=========    +=====================+
    | 10.0.0.1:111        | 0          | 00:C1:AB:00:00:11 | 0.0.0.0             | 10.0.0.1            | -                   |     100     |                     |
    +---------------------+------------+-------------------+---------------------+---------------------+---------------------+---------    +---------------------+
    ---------------------------------------------------------------------------------------------------------------------------------------------------    -----------
    Type 3 Inclusive Multicast Ethernet Tag Routes
    +---------------------------+------------+---------------------+---------------------------+---------------------------+---------    +---------------------------+
    |    Route-distinguisher    |   Tag-ID   |    Originator-IP    |         Next-Hop          |            MED            | LocPref |               Path            |
    +===========================+============+=====================+===========================+===========================+=========    +===========================+
    | 10.0.0.1:111              | 0          | 10.0.0.1            | 10.0.0.1                  | -                         |     100     |                           |
    +---------------------------+------------+---------------------+---------------------------+---------------------------+---------    +---------------------------+
    ---------------------------------------------------------------------------------------------------------------------------------------------------    -----------
    Type 4 Ethernet Segment Routes
    +---------------------+--------------------------------+---------------------+---------------------+---------------------+---------    +---------------------+
    | Route-distinguisher |              ESI               |   Originating-IP    |      Next-Hop       |         MED         | LocPref |            Path         |
    +=====================+================================+=====================+=====================+=====================+=========    +=====================+
    | 10.0.0.1:0          | 01:11:11:11:11:11:11:00:00:01  | 10.0.0.1            | 10.0.0.1            | -                   |     100     |                     |
    +---------------------+--------------------------------+---------------------+---------------------+---------------------+---------    +---------------------+
    ---------------------------------------------------------------------------------------------------------------------------------------------------    -----------
    ---------------------------------------------------------------------------------------------------------------------------------------------------    -----------
    2 advertised Ethernet Auto-Discovery routes
    1 advertised MAC-IP Advertisement routes
    1 advertised Inclusive Multicast Ethernet Tag routes
    1 advertised Ethernet Segment routes
    0 advertised IP Prefix routes
    ---------------------------------------------------------------------------------------------------------------------------------------------------    -----------
    ```
=== "leaf2"
    ```
    A:leaf2# show network-instance default protocols bgp neighbor 10.0.0.1 advertised-routes evpn
    ---------------------------------------------------------------------------------------------------------------------------------------------------    --
    Peer        : 10.0.0.1, remote AS: 100, local AS: 100
    Type        : static
    Description : None
    Group       : iBGP-overlay
    ---------------------------------------------------------------------------------------------------------------------------------------------------    --
    Origin codes: i=IGP, e=EGP, ?=incomplete
    ---------------------------------------------------------------------------------------------------------------------------------------------------    --
    ---------------------------------------------------------------------------------------------------------------------------------------------------    --
    Type 1 Ethernet Auto-Discovery Routes
    +----------------------+--------------------------------+------------+----------------------+----------------------+---------    +----------------------+
    | Route-distinguisher  |              ESI               |   Tag-ID   |       Next-Hop       |         MED          | LocPref |             Path         |
    +======================+================================+============+======================+======================+=========    +======================+
    | 10.0.0.2:111         | 01:11:11:11:11:11:11:00:00:01  | 0          | 10.0.0.2             | -                    |     100     |                      |
    | 10.0.0.2:111         | 01:11:11:11:11:11:11:00:00:01  | 4294967295 | 10.0.0.2             | -                    |     100     |                      |
    +----------------------+--------------------------------+------------+----------------------+----------------------+---------    +----------------------+
    Type 2 MAC-IP Advertisement Routes
    +--------------------+------------+-------------------+--------------------+--------------------+--------------------+---------    +--------------------+
    |       Route-       |   Tag-ID   |    MAC-address    |     IP-address     |      Next-Hop      |        MED         | LocPref |            Path        |
    |       distinguisher    |            |                   |                    |                    |                    |         |                    |
    +====================+============+===================+====================+====================+====================+=========    +====================+
    | 10.0.0.2:111       | 0          | 00:C1:AB:00:00:11 | 0.0.0.0            | 10.0.0.2           | -                  |     100     |                    |
    +--------------------+------------+-------------------+--------------------+--------------------+--------------------+---------    +--------------------+
    ---------------------------------------------------------------------------------------------------------------------------------------------------    --
    Type 3 Inclusive Multicast Ethernet Tag Routes
    +------------------------+------------+---------------------+------------------------+------------------------+---------+------------------------+
    |  Route-distinguisher   |   Tag-ID   |    Originator-IP    |        Next-Hop        |          MED           | LocPref |          Path          |
    +========================+============+=====================+========================+========================+=========+========================+
    | 10.0.0.2:111           | 0          | 10.0.0.2            | 10.0.0.2               | -                      | 100     |                        |
    +------------------------+------------+---------------------+------------------------+------------------------+---------+------------------------+
    ---------------------------------------------------------------------------------------------------------------------------------------------------    --
    Type 4 Ethernet Segment Routes
    +--------------------+--------------------------------+--------------------+--------------------+--------------------+---------    +--------------------+
    |       Route-       |              ESI               |   Originating-IP   |      Next-Hop      |        MED         | LocPref |            Path        |
    |       distinguisher    |                                |                    |                    |                    |         |                    |
    +====================+================================+====================+====================+====================+=========    +====================+
    | 10.0.0.2:0         | 01:11:11:11:11:11:11:00:00:01  | 10.0.0.2           | 10.0.0.2           | -                  |     100     |                    |
    +--------------------+--------------------------------+--------------------+--------------------+--------------------+---------    +--------------------+
    ---------------------------------------------------------------------------------------------------------------------------------------------------    --
    ---------------------------------------------------------------------------------------------------------------------------------------------------    --
    2 advertised Ethernet Auto-Discovery routes
    1 advertised MAC-IP Advertisement routes
    1 advertised Inclusive Multicast Ethernet Tag routes
    1 advertised Ethernet Segment routes
    0 advertised IP Prefix routes
    ---------------------------------------------------------------------------------------------------------------------------------------------------    --
    ```
RT1, RT3 and RT4 routes are triggered by configuration (ES and MAC-VRF), while RT2 routes (MAC-IP) only appear when a MAC is learned or statically configured.

Among these, RT4 is known as ES routes imported by ES peers for DF election and local biasing (split-horizon). It is advertised/received here only by leaf1 and leaf2.

RT1 also advertises ESIs, mainly for two reasons (hence two entries per ESI):

+ Aliasing for load balancing (0)
+ Mass withdrawal for fast convergence (4294967295)

Let's see what leaf2 and leaf3 get in their BGP EVPN route table:

=== "leaf2"
    ```
    A:leaf2# show network-instance default protocols bgp routes evpn route-type summary
    ------------------------------------------------------------------------------------------------------------------------------------------------------------------
    Show report for the BGP route table of network-instance "default"
    ------------------------------------------------------------------------------------------------------------------------------------------------------------------
    Status codes: u=used, *=valid, >=best, x=stale
    Origin codes: i=IGP, e=EGP, ?=incomplete
    ------------------------------------------------------------------------------------------------------------------------------------------------------------------
    BGP Router ID: 10.0.0.2      AS: 102      Local AS: 102
    ------------------------------------------------------------------------------------------------------------------------------------------------------------------
    ------------------------------------------------------------------------------------------------------------------------------------------------------------------
    Type 1 Ethernet Auto-Discovery Routes
    +--------+-------------------------+--------------------------------+------------+-------------------------+-------------------------+-------------------------+
    | Status |   Route-distinguisher   |              ESI               |   Tag-ID   |        neighbor         |        Next-hop         |           VNI           |
    +========+=========================+================================+============+=========================+=========================+=========================+
    | u*>    | 10.0.0.1:111            | 01:11:11:11:11:11:11:00:00:01  | 0          | 10.0.0.1                | 10.0.0.1                | 1                       |
    | u*>    | 10.0.0.1:111            | 01:11:11:11:11:11:11:00:00:01  | 4294967295 | 10.0.0.1                | 10.0.0.1                | -                       |
    +--------+-------------------------+--------------------------------+------------+-------------------------+-------------------------+-------------------------+
    Type 2 MAC-IP Advertisement Routes
    +-------+--------------+-----------+-----------------+--------------+--------------+--------------+--------------+-----------------------------+--------------+
    | Statu | Route-distin |  Tag-ID   |   MAC-address   |  IP-address  |   neighbor   |   Next-Hop   |     VNI      |             ESI             | MAC Mobility |
    |   s   |   guisher    |           |                 |              |              |              |              |                             |              |
    +=======+==============+===========+=================+==============+==============+==============+==============+=============================+==============+
    | u*>   | 10.0.0.1:111 | 0         | 00:C1:AB:00:00: | 0.0.0.0      | 10.0.0.1     | 10.0.0.1     | 1            | 01:11:11:11:11:11:11:00:00: | -            |
    |       |              |           | 11              |              |              |              |              | 01                          |              |
    | u*>   | 10.0.0.3:111 | 0         | 00:C1:AB:00:00: | 0.0.0.0      | 10.0.0.3     | 10.0.0.3     | 1            | 00:00:00:00:00:00:00:00:00: | -            |
    |       |              |           | 21              |              |              |              |              | 00                          |              |
    | u*>   | 10.0.0.3:111 | 0         | 00:C1:AB:00:00: | 0.0.0.0      | 10.0.0.3     | 10.0.0.3     | 1            | 00:00:00:00:00:00:00:00:00: | -            |
    |       |              |           | 23              |              |              |              |              | 00                          |              |
    +-------+--------------+-----------+-----------------+--------------+--------------+--------------+--------------+-----------------------------+--------------+
    ------------------------------------------------------------------------------------------------------------------------------------------------------------------
    Type 3 Inclusive Multicast Ethernet Tag Routes
    +--------+--------------------------------------+------------+---------------------+--------------------------------------+--------------------------------------+
    | Status |         Route-distinguisher          |   Tag-ID   |    Originator-IP    |               neighbor               |               Next-Hop               |
    +========+======================================+============+=====================+======================================+======================================+
    | u*>    | 10.0.0.1:111                         | 0          | 10.0.0.1            | 10.0.0.1                             | 10.0.0.1                             |
    | u*>    | 10.0.0.3:111                         | 0          | 10.0.0.3            | 10.0.0.3                             | 10.0.0.3                             |
    +--------+--------------------------------------+------------+---------------------+--------------------------------------+--------------------------------------+
    ------------------------------------------------------------------------------------------------------------------------------------------------------------------
    Type 4 Ethernet Segment Routes
    +--------+----------------------------+--------------------------------+----------------------------+----------------------------+----------------------------+
    | Status |    Route-distinguisher     |              ESI               |     originating-router     |          neighbor          |          Next-Hop          |
    +========+============================+================================+============================+============================+============================+
    | u*>    | 10.0.0.1:0                 | 01:11:11:11:11:11:11:00:00:01  | 10.0.0.1                   | 10.0.0.1                   | 10.0.0.1                   |
    +--------+----------------------------+--------------------------------+----------------------------+----------------------------+----------------------------+
    ------------------------------------------------------------------------------------------------------------------------------------------------------------------
    2 Ethernet Auto-Discovery routes 2 used, 2 valid
    3 MAC-IP Advertisement routes 3 used, 3 valid
    2 Inclusive Multicast Ethernet Tag routes 2 used, 2 valid
    1 Ethernet Segment routes 1 used, 1 valid
    0 IP Prefix routes 0 used, 0 valid
    ------------------------------------------------------------------------------------------------------------------------------------------------------------------
    ```
=== "leaf3"
    ```
    A:leaf3# show network-instance default protocols bgp routes evpn route-type summary
    -------------------------------------------------------------------------------------------------------------------------------------------------------------------
    Show report for the BGP route table of network-instance "default"
    -------------------------------------------------------------------------------------------------------------------------------------------------------------------
    Status codes: u=used, *=valid, >=best, x=stale
    Origin codes: i=IGP, e=EGP, ?=incomplete
    -------------------------------------------------------------------------------------------------------------------------------------------------------------------
    BGP Router ID: 10.0.0.3      AS: 103      Local AS: 103
    -------------------------------------------------------------------------------------------------------------------------------------------------------------------
    -------------------------------------------------------------------------------------------------------------------------------------------------------------------
    Type 1 Ethernet Auto-Discovery Routes
    +--------+-------------------------+--------------------------------+------------+-------------------------+-------------------------+-------------------------+
    | Status |   Route-distinguisher   |              ESI               |   Tag-ID   |        neighbor         |        Next-hop         |           VNI           |
    +========+=========================+================================+============+=========================+=========================+=========================+
    | u*>    | 10.0.0.1:111            | 01:11:11:11:11:11:11:00:00:01  | 0          | 10.0.0.1                | 10.0.0.1                | 1                       |
    | u*>    | 10.0.0.1:111            | 01:11:11:11:11:11:11:00:00:01  | 4294967295 | 10.0.0.1                | 10.0.0.1                | -                       |
    | u*>    | 10.0.0.2:111            | 01:11:11:11:11:11:11:00:00:01  | 0          | 10.0.0.2                | 10.0.0.2                | 1                       |
    | u*>    | 10.0.0.2:111            | 01:11:11:11:11:11:11:00:00:01  | 4294967295 | 10.0.0.2                | 10.0.0.2                | -                       |
    +--------+-------------------------+--------------------------------+------------+-------------------------+-------------------------+-------------------------+
    Type 2 MAC-IP Advertisement Routes
    +-------+--------------+-----------+-----------------+--------------+--------------+--------------+--------------+-----------------------------+--------------+
    | Statu | Route-distin |  Tag-ID   |   MAC-address   |  IP-address  |   neighbor   |   Next-Hop   |     VNI      |             ESI             | MAC Mobility |
    |   s   |   guisher    |           |                 |              |              |              |              |                             |              |
    +=======+==============+===========+=================+==============+==============+==============+==============+=============================+==============+
    | u*>   | 10.0.0.1:111 | 0         | 00:C1:AB:00:00: | 0.0.0.0      | 10.0.0.1     | 10.0.0.1     | 1            | 01:11:11:11:11:11:11:00:00: | -            |
    |       |              |           | 11              |              |              |              |              | 01                          |              |
    | u*>   | 10.0.0.2:111 | 0         | 00:C1:AB:00:00: | 0.0.0.0      | 10.0.0.2     | 10.0.0.2     | 1            | 01:11:11:11:11:11:11:00:00: | -            |
    |       |              |           | 11              |              |              |              |              | 01                          |              |
    +-------+--------------+-----------+-----------------+--------------+--------------+--------------+--------------+-----------------------------+--------------+
    -------------------------------------------------------------------------------------------------------------------------------------------------------------------
    Type 3 Inclusive Multicast Ethernet Tag Routes
    +--------+--------------------------------------+------------+---------------------+--------------------------------------+--------------------------------------+
    | Status |         Route-distinguisher          |   Tag-ID   |    Originator-IP    |               neighbor               |               Next-Hop               |
    +========+======================================+============+=====================+======================================+======================================+
    | u*>    | 10.0.0.1:111                         | 0          | 10.0.0.1            | 10.0.0.1                             | 10.0.0.1                             |
    | u*>    | 10.0.0.2:111                         | 0          | 10.0.0.2            | 10.0.0.2                             | 10.0.0.2                             |
    +--------+--------------------------------------+------------+---------------------+--------------------------------------+--------------------------------------+
    -------------------------------------------------------------------------------------------------------------------------------------------------------------------
    4 Ethernet Auto-Discovery routes 4 used, 4 valid
    2 MAC-IP Advertisement routes 2 used, 2 valid
    2 Inclusive Multicast Ethernet Tag routes 2 used, 2 valid
    0 Ethernet Segment routes 0 used, 0 valid
    0 IP Prefix routes 0 used, 0 valid
    -------------------------------------------------------------------------------------------------------------------------------------------------------------------
    ```

As an ES peer, leaf2 receives both RT1 and RT4 in its table, while leaf3 only imports RT1 since it is a remote PE.

Finally, check the MAC table of the `mac-vrf-1` on leaf3, which should show the `esi` instead of an individual destination for the MAC address of ce1.

```
A:leaf3# show network-instance mac-vrf-1 bridge-table mac-table all
-----------------------------------------------------------------------------------------------------------------------------------------------------
Mac-table of network instance mac-vrf-1
-----------------------------------------------------------------------------------------------------------------------------------------------------
+--------------------+---------------------------------------+------------+------------+---------+--------+---------------------------------------+
|      Address       |              Destination              | Dest Index |    Type    | Active  | Aging  |              Last Update              |
+====================+=======================================+============+============+=========+========+=======================================+
| 00:C1:AB:00:00:11  | vxlan-interface:vxlan1.1              | 7173081172 | evpn       | true    | N/A    | 2023-08-17T10:34:59.000Z              |
|                    | esi:01:11:11:11:11:11:11:00:00:01     | 20         |            |         |        |                                       |
| 00:C1:AB:00:00:21  | ethernet-1/1.0                        | 3          | learnt     | true    | 300    | 2023-08-17T10:34:59.000Z              |
| 00:C1:AB:00:00:22  | ethernet-1/2.0                        | 4          | learnt     | true    | 300    | 2023-08-17T10:35:01.000Z              |
| 00:C1:AB:00:00:23  | ethernet-1/3.0                        | 5          | learnt     | true    | 300    | 2023-08-17T10:35:03.000Z              |
+--------------------+---------------------------------------+------------+------------+---------+--------+---------------------------------------+
Total Irb Macs                 :    0 Total    0 Active
Total Static Macs              :    0 Total    0 Active
Total Duplicate Macs           :    0 Total    0 Active
Total Learnt Macs              :    3 Total    3 Active
Total Evpn Macs                :    1 Total    1 Active
Total Evpn static Macs         :    0 Total    0 Active
Total Irb anycast Macs         :    0 Total    0 Active
Total Proxy Antispoof Macs     :    0 Total    0 Active
Total Reserved Macs            :    0 Total    0 Active
Total Eth-cfm Macs             :    0 Total    0 Active
--{ running }--[  ]--
```

With that, we verified a working L2 EVPN multihoming on a SR Linux fabric.

To delete this lab, from the lab path:

```bash
containerlab destroy -t evpn-mh.clab.yml
```

<script type="text/javascript" src="https://viewer.diagrams.net/js/viewer-static.min.js" async></script>
